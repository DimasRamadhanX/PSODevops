steps:
  - name: Checkout main branch
    uses: actions/checkout@v4
    with:
      ref: main
      token: ${{ secrets.PERSONAL_GITHUB_TOKEN }}

  - name: Configure Git
    run: |
      git config --global user.email "github-actions[bot]@users.noreply.github.com"
      git config --global user.name "github-actions[bot]"

  - name: Fetch all branches
    run: git fetch origin

  - name: Merge dev into main
    run: |
      git merge origin/dev --no-ff -m "Auto-merge dev into main [CI success]"

  - name: Push changes to main
    run: git push origin main
    env:
      GITHUB_TOKEN: ${{ secrets.PERSONAL_GITHUB_TOKEN }}